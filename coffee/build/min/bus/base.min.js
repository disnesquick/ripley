var Bus,TimeoutError,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};TimeoutError=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Error),Bus=function(){function a(){var a,b,c;for(this.messageCount=-1,this.messageQueues=[],b=c=0;0<=mqLen?c<=mqLen:c>=mqLen;b=0<=mqLen?++c:--c)this.messageQueues.push({});a=this.messageQueuesTick.bind(this),this.messageQueueWatchdog=setInterval(a,tickLen)}return a.prototype.messageQueuesTick=function(){var a,b,c,d,e;this.messageQueues.unshift({}),b=this.messageQueues.pop(),e=[];for(d in b)a=b[d],c=a[1],e.push(c(new TimeoutError));return e},a.prototype.waitForReply=function(a,b,c){var d,e;return this.messageCount+=1,d=SerialID.integerToBytes(this.messageCount),e=this.messageQueues[0],e[d]=[a,b,c],d},a.prototype.resolveMessageID=function(a,b){var c,d,e,f,g;for(g=this.messageQueues,e=0,f=g.length;f>e;e++)if(c=g[e],a in c){if(d=c[a],d[2]!==b)throw new UnknownMessageIDError(a);return c.pop(a),d.pop(),d}throw new UnknownMessageIDError(a)},a.prototype.getBootstrapConnection=function(a){var b,c,d,e,f,g,h,i,j,k,l;return g=new OpenRoute,j=g.supplyTransport(a),l=a.bootstrap(j),i=l[0],d=l[1],f=l[2],e=l[3],c=new Connection(this,d),g.supplyConnection(c),g.completeRoute(i,f),h=g.route,k=new BusMasterService(h),b=k.getBusMaster(void 0),c.addTransverseMap(busClientService.exposedTransverse),c.addTransverseMap(basicErrorService.exposedTransverse),[c,b,e]},a.prototype.connection=function(){var a,b;return a=this.masterService.getNeonateID(),b=new Connection(this,a),b.addTransverseMap(basicErrorService.exposedTransverse),b},a.prototype.reportDestinationFailure=function(a){return a.transport.unregisterRoute(a)},a}();